<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style></style>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
<link rel="stylesheet" href="static/css/modal.css">

</head>

<body>
     			<div class="modal">
			        <div class="modal_body">
			        	<input type="hidden" th:value="${session.loginUser.userNo}" name="userNo" />
			       
			            <h2>친구목록</h2> <input type="text" placeholder="닉네임" th:value="${nickName}" name="nickName"/><button type="button" onclick="searchUser()">검색</button>
			     
			           
			            <hr>
			            <ul id="searchList">
			            	
			            </ul>
			            <hr>
			            <h3>내친구</h3>
			            <ul id="friendList" >
			            	 
			            </ul>
			        </div>
			    </div>
			    <br>
			    <button class="btn-open-modal"> <img src="static/icon/person-arms-up.svg"/> </button>
			    
    <script>
        const modal = document.querySelector('.modal');
        const btnOpenModal=document.querySelector('.btn-open-modal');
        
        onload = () => {
        	viewFriends();
        }
        
        

        btnOpenModal.addEventListener("click", ()=>{
            modal.style.display="flex";
        });
        
        function searchUser(){
        	
        	$.ajax({
        		url : "searchUser",
        		type : "post",
        		data : {nickName: $("input[name=nickName]").val()},
        		success : function(result){
        				console.log(result);
        				if (result && result.length > 0) {		// "" ==> [{}]
        					let searchList = "";
        				
        					for (let i=0; i < result.length; i++) {
        						searchList += "<li>"
    								+ result[i].nickName 
    								+ "<input type='button' no='" + result[i].userNo + "' value='+' onclick='addFriends(this)' /> "
    							+ "</li>";
        						
        					}
        				
        					$("#searchList").html(searchList);
        				}
        		},
        		error : function(error){
        			
        		
        			}
        		
        	})
        }
        	
        
        function addFriends(target) {
        	alert('[내친구]에 추가되었습니다.');
        	$.ajax({
        		url : "addfriend",
        		type : "post",
        		data : {
        			userNo: $("input[name=userNo]").val(),
        			friendNo: $(target).attr('no')
        		},
        		success : function(result){
        			console.log(result);
        			viewFriends();
	        			
    			},
    			error : function(error){
		    			
    			}
       			    	
        	})
        }
        function viewFriends(){
        $.ajax({
    		url : "flist",
    		data: {userNo: $("input[name=userNo]").val()},
    		success: (result) => {
    			if (result && result.length > 0) {		// "" ==> [{}]
					let friendList = "";
				
					for (let i=0; i < result.length; i++) {
						friendList += "<li>"
							+ result[i]
						+ "</li>";
						
					}
				
					$("#friendList").html(friendList);
				}
    		},
    		error: (error) => {
    			
    		}
    	});
        }
    </script>
</body>
</html>